This is the readme file of the ILK-Compiler tool.

# Usage

## Prerequisites

A valid `Lua` interpreter (`Lua5.2` -- suggested, `Lua5.3` or `Luajit`),
and the `luarocks` tool are required. Please install them from your package
manager (or from sources). For example, you could follow this procedure
(tested on Ubuntu 16.04 - requires `wget`, `unzip`, `tar`, `make`, `git`):


1. Install Lua 5.2 and liblua5.2-dev (**NOTE**: getting luarocks using
   `apt-get install` results in an incompatible installation on Ubuntu 16.04 as
   of 14 Jun 2018)

     ```sudo apt-get install lua5.2 liblua5.2-dev```

2. Download and install luarocks
    - download from `https://luarocks.org/` or using `wget`:

        ```wget http://luarocks.github.io/luarocks/releases/luarocks-2.4.4.tar.gz```
    - unpack the source archive:

        `tar zxvf luarocks-2.4.4.tar.gz`
    - build it:

        ```
        cd luarocks-2.4.4/
        ./configure --lua-version=5.2
        make build
        sudo make install
        cd ..
        ```

3. Install Lua dependencies using luarocks:

    ```
    cd etc
    luarocks install --local lua-deps-1.0-1.rockspec
    ```


## Running the tool

First issue this command in your shell:

```
eval `luarocks path`
```

And then you can run the actual compiler:

```
./ilk-compiler -b eigen --indir <dir with input files>  --outdir <output dir>
```

For usage information, you can also type

```
./ilk-compiler --help
```

# Generated code

The output directory will contain the C/C++ code generated by the compiler.
Before trying to build this C code, please follow the steps described in the
next section

## Prerequisites

Make sure that the file `robot-defs.h` (generated previously by the ILK-Generator
(_TODO_ link) ) is copied alongside with the generated source code. Normally,
`robot-defs.h` is copied automatically from the input folder to the output
folder.

You will need the Eigen3 C++ library installed in your system, including
the corresponding `pkg-config` configuration file (which is usually
`/usr/local/share/pkgconfig/eigen3.pc`). This file will be installed if you
follow the standard `make` procedure for Eigen.

You also need the Eigen backend which is shipped within this repository. This
is a minimal collection of support functions referenced by the generated code.
Please build and install it in your system, using the standard CMake procedure:

```
cd backend/eigen
mkdir build
cd build
cmake ..
make
sudo make install
```

## Building
Finally, you can compile the generated code simply with `make`.
